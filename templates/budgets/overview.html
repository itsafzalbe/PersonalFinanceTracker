

{% extends 'base.html' %}
{% load i18n %}
{% block title %}{% trans "Budget Overview" %} - Finance Tracker{% endblock %}
{% block content %}
<div class="row mb-4">
    <div class="col-md-8">
        <h1 class="display-6"><i class="bi bi-graph-up"></i> {% trans "Budget Overview" %}</h1>
        <p class="text-muted">{% trans "See all your budgets at a glance" %}</p>
    </div>
    <div class="col-md-4 text-md-end">
        <a href="{% url 'budgets:budget_list' %}" class="btn btn-outline-secondary"><i class="bi bi-arrow-left"></i> {% trans "Back" %}</a>
    </div>
</div>

<!-- Summary Cards -->
<div class="row g-4 mb-4">
    <div class="col-md-3">
        <div class="stats-card"><div><p class="mb-1 opacity-75">{% trans "Total Budgeted" %}</p><h3>{{ total_budget_amount|floatformat:0 }}</h3><small class="opacity-75">{{ currency }}</small></div><i class="bi bi-piggy-bank fs-1 opacity-50"></i></div>
    </div>
    <div class="col-md-3">
        <div class="stats-card red"><div><p class="mb-1 opacity-75">{% trans "Total Spent" %}</p><h3>{{ total_spent|floatformat:0 }}</h3><small class="opacity-75">{{ currency }}</small></div><i class="bi bi-arrow-up-circle fs-1 opacity-50"></i></div>
    </div>
    <div class="col-md-3">
        <div class="stats-card {% if total_remaining >= 0 %}green{% else %}orange{% endif %}"><div><p class="mb-1 opacity-75">{% trans "Remaining" %}</p><h3>{{ total_remaining|floatformat:0 }}</h3><small class="opacity-75">{{ currency }}</small></div><i class="bi bi-wallet2 fs-1 opacity-50"></i></div>
    </div>
    <div class="col-md-3">
        <div class="stats-card blue"><div><p class="mb-1 opacity-75">{% trans "Active Budgets" %}</p><h3>{{ active_budgets }}</h3><small class="opacity-75">{% trans "Total" %}</small></div><i class="bi bi-list-check fs-1 opacity-50"></i></div>
    </div>
</div>

<!-- Overall Progress -->
<div class="card mb-4">
    <div class="card-body">
        <h5 class="mb-3">{% trans "Overall Budget Progress" %}</h5>
        <div class="progress mb-2" style="height: 25px;">
            <div class="progress-bar {% if overall_percentage > 100 %}bg-danger{% elif overall_percentage >= 80 %}bg-warning{% else %}bg-success{% endif %}"
                 style="width: {% if overall_percentage > 100 %}100{% else %}{{ overall_percentage }}{% endif %}%">
                {{ overall_percentage|floatformat:1 }}%
            </div>
        </div>
        <div class="d-flex justify-content-between">
            <span class="text-muted">{% if budgets_over_limit %}<i class="bi bi-exclamation-triangle text-danger"></i> {{ budgets_over_limit }} {% trans "over budget" %}{% endif %}</span>
            <span class="text-muted">{% if budgets_at_warning %}<i class="bi bi-exclamation-circle text-warning"></i> {{ budgets_at_warning }} {% trans "at warning" %}{% endif %}</span>
        </div>
    </div>
</div>

<!-- Individual Budgets -->
<div class="row g-4">
    {% for budget in budgets %}
    <div class="col-md-6">
        <div class="card">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start mb-2">
                    <h6>{{ budget.name }}</h6>
                    <span class="badge bg-light text-dark">{{ budget.get_period_display }}</span>
                </div>
                <div class="mb-2">
                    <div class="d-flex justify-content-between mb-1">
                        <small>{{ budget.spent|floatformat:0 }} / {{ budget.amount|floatformat:0 }} {{ budget.currency.code }}</small>
                        <small class="{% if budget.over_budget %}text-danger{% else %}text-muted{% endif %}">{{ budget.percentage|floatformat:1 }}%</small>
                    </div>
                    <div class="progress" style="height: 6px;">
                        <div class="progress-bar {% if budget.over_budget %}bg-danger{% elif budget.percentage >= budget.alert_threshold %}bg-warning{% else %}bg-success{% endif %}"
                             style="width: {% if budget.percentage > 100 %}100{% else %}{{ budget.percentage }}{% endif %}%"></div>
                    </div>
                </div>
                <a href="{% url 'budgets:budget_detail' budget.pk %}" class="btn btn-sm btn-outline-primary">{% trans "View Details" %}</a>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% endblock %}