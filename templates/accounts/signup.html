
{% extends 'base.html' %}
{% load i18n %}

{% block title %}{% trans "Sign Up" %} - Finance Tracker{% endblock %}

{% block content %}
<div class="auth-container">
    <div class="auth-card">
        <div class="card shadow-lg">
            <div class="card-body p-5">
                <div class="text-center mb-4">
                    <div class="mb-3">
                        <i class="bi bi-wallet2 text-primary" style="font-size: 3rem;"></i>
                    </div>
                    <h2 class="card-title">{% trans "Create Your Account" %}</h2>
                    <p class="text-muted">{% trans "Start tracking your finances today" %}</p>
                </div>
                
                <form method="post" novalidate id="signupForm">
                    {% csrf_token %}
                    
                    <div class="mb-4">
                        <label for="{{ form.email.id_for_label }}" class="form-label">
                            <i class="bi bi-envelope"></i> {% trans "Email Address" %}
                        </label>
                        {{ form.email }}
                        {% if form.email.errors %}
                            <div class="invalid-feedback d-block">
                                {{ form.email.errors.0 }}
                            </div>
                        {% endif %}
                        <div class="form-text">{% trans "We'll send you a verification code" %}</div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary w-100 py-3 mb-3">
                        <i class="bi bi-envelope-check"></i> {% trans "Send Verification Code" %}
                    </button>
                </form>
                
                <hr class="my-4">
                
                <p class="text-center mb-0">
                    {% trans "Already have an account?" %} <a href="{% url 'accounts:login' %}" class="text-decoration-none fw-bold">{% trans "Login" %}</a>
                </p>
            </div>
        </div>
        
        <!-- Features -->
        <div class="row mt-4">
            <div class="col-md-4 text-center mb-3">
                <i class="bi bi-shield-check text-primary" style="font-size: 2rem;"></i>
                <p class="small mt-2 mb-0">{% trans "Secure & Private" %}</p>
            </div>
            <div class="col-md-4 text-center mb-3">
                <i class="bi bi-graph-up text-success" style="font-size: 2rem;"></i>
                <p class="small mt-2 mb-0">{% trans "Track Expenses" %}</p>
            </div>
            <div class="col-md-4 text-center mb-3">
                <i class="bi bi-piggy-bank text-warning" style="font-size: 2rem;"></i>
                <p class="small mt-2 mb-0">{% trans "Save Money" %}</p>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Email availability check
const emailInput = document.querySelector('#{{ form.email.id_for_label }}');
if (emailInput) {
    let timeout = null;
    emailInput.addEventListener('input', function() {
        clearTimeout(timeout);
        timeout = setTimeout(() => {
            const email = this.value;
            if (email.includes('@')) {
                fetch(`{% url 'accounts:check_email' %}?email=${encodeURIComponent(email)}`)
                    .then(response => response.json())
                    .then(data => {
                        if (!data.available) {
                            this.classList.add('is-invalid');
                            const feedback = this.parentElement.querySelector('.invalid-feedback') || document.createElement('div');
                            feedback.className = 'invalid-feedback d-block';
                            feedback.textContent = 'An account with this email already exists.';
                            if (!this.parentElement.querySelector('.invalid-feedback')) {
                                this.parentElement.appendChild(feedback);
                            }
                        } else {
                            this.classList.remove('is-invalid');
                            const feedback = this.parentElement.querySelector('.invalid-feedback');
                            if (feedback && feedback.textContent.includes('already exists')) {
                                feedback.remove();
                            }
                        }
                    });
            }
        }, 500);
    });
}
</script>
{% endblock %}