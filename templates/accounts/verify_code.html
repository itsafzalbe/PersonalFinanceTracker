
{% extends 'base.html' %}
{% load i18n %}

{% block title %}{% trans "Verify Email - Finance Tracker" %}{% endblock %}

{% block content %}
<div class="auth-container">
    <div class="auth-card">
        <div class="card shadow-lg">
            <div class="card-body p-5">
                <div class="text-center mb-4">
                    <div class="mb-3">
                        <i class="bi bi-shield-check text-success" style="font-size: 3rem;"></i>
                    </div>
                    <h2 class="card-title">{% trans "Verify Your Email" %}</h2>
                    <p class="text-muted">
                        {% trans "We've sent a 4-digit code to" %}<br>
                        <strong class="text-primary">{{ email }}</strong>
                    </p>
                </div>
                
                <form method="post" novalidate>
                    {% csrf_token %}
                    
                    <div class="mb-4">
                        <label for="{{ form.code.id_for_label }}" class="form-label">
                            <i class="bi bi-key"></i> {% trans "Verification Code" %}
                        </label>
                        <input type="text" 
                               class="form-control form-control-lg text-center" 
                               id="{{ form.code.id_for_label }}"
                               name="code"
                               maxlength="4"
                               pattern="[0-9]{4}"
                               autocomplete="off"
                               placeholder="• • • •"
                               style="font-size: 2rem; letter-spacing: 1rem;"
                               required>
                        {% if form.code.errors %}
                            <div class="invalid-feedback d-block">
                                {{ form.code.errors.0 }}
                            </div>
                        {% endif %}
                        <div class="form-text">
                            <i class="bi bi-clock"></i> {% trans "Code expires in 2 minutes" %}
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary w-100 py-3 mb-3">
                        <i class="bi bi-check-circle"></i> {% trans "Verify Code" %}
                    </button>
                </form>
                
                <div class="text-center">
                    {% if can_resend %}
                        <form method="post" action="{% url 'accounts:resend_code' %}" class="d-inline">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-link text-decoration-none">
                                <i class="bi bi-arrow-clockwise"></i> {% trans "Resend Code" %}
                            </button>
                        </form>
                    {% else %}
                        <p class="text-muted small">
                            <i class="bi bi-hourglass-split"></i> {% trans "Please wait 2 minutes before requesting a new code" %}
                        </p>
                    {% endif %}
                </div>
                
                <hr class="my-4">
                
                <p class="text-center mb-0 small text-muted">
                    {% trans "Wrong email?" %} <a href="{% url 'accounts:signup' %}" class="text-decoration-none">{% trans "Start over" %}</a>
                </p>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Auto-focus and auto-submit on 4 digits
const codeInput = document.querySelector('#{{ form.code.id_for_label }}');
if (codeInput) {
    codeInput.focus();
    
    // Only allow numbers
    codeInput.addEventListener('input', function(e) {
        this.value = this.value.replace(/[^0-9]/g, '');
        
        // Auto-submit when 4 digits entered
        if (this.value.length === 4) {
            this.form.submit();
        }
    });
}
</script>
{% endblock %}